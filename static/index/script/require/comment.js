"use strict";(function(){app.comment=function(t,e){var n,o;return n={type:t,id:e},(o={}).back=function(){return n.cid=null,n.editor.back()},o.bind=function(){var t,e;return t=$("#comment"),n.comment=app.model.comment(t),n.comment.bind(),n.comment.set({type:n.type,id:n.id,pageNo:1}),t.on("event-flip",function(t,e){return app.dom.fixed.data().fn.setCommentCount(e.count)}),t.on("event-quote",function(t,e){return o.quote(e)}),e=$("#editor"),n.editor=app.model.editor(e),n.editor.create({menu:["img","emotion"]}),n.editor.bind(),n.editor.initUpload(),n.editor.set({type:n.type,id:n.id,title:"评论",limit:[5,1e3]}),e.on("event-submit",function(t,e){return n.attachment=e,o.send()}),e.on("event-cancel",function(){return o.back()}),e.on("click",function(t){if(~t.target.className.search("status-empty"))return o.back()})},o.quote=function(t){return n.cid=t.data().cid,n.editor.move(t.find(".content-comment:last"))},o.send=function(){return n.editor.send("/member/"+n.id+"/comment",{type:n.type,text:n.editor.get("content"),quoteId:n.cid}).fail(function(t){return $.info(t)}).done(function(){return $.info("发送成功"),o.back(),n.editor.blur(),n.comment.set({pageNo:1}),n.comment.focus("force")})},o.bind()}}).call(void 0);